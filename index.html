<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048æ™‚é–“</title>
    <style>
        /* æ•´é«”é é¢æ¨£å¼è¨­å®š */
        body {
            font-family: Arial, sans-serif; /* è¨­å®šå­—é«” */
            display: flex; /* ä½¿ç”¨ Flexbox ä½ˆå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´  */
            justify-content: center; /* å‚ç›´å±…ä¸­å°é½Š */
            align-items: center; /* æ°´å¹³å±…ä¸­å°é½Š */
            height: 100vh; /* ä½”æ»¿æ•´å€‹è¦–çª—é«˜åº¦ */
            margin: 0; /* ç§»é™¤é è¨­å¤–é‚Šè· */
            background-color: #faf8ef; /* è¨­å®šèƒŒæ™¯é¡è‰² */
        }
        /* åˆ†æ•¸æ¿æ¨£å¼ */
        #score-board {
            margin-bottom: 20px; /* ä¸‹æ–¹é–“è· */
            font-size: 24px; /* å­—é«”å¤§å° */
            font-weight: bold; /* å­—é«”ç²—ç´° */
            color: #776e65; /* å­—é«”é¡è‰² */
        }
        /* éŠæˆ²æ¿æ¨£å¼ */
        #game-board {
            display: grid; /* ä½¿ç”¨ Grid ä½ˆå±€ */
            grid-gap: 10px; /* ç¶²æ ¼é–“è· */
            background-color: #bbada0; /* èƒŒæ™¯é¡è‰² */
            padding: 10px; /* å…§é‚Šè· */
            border-radius: 10px; /* åœ“è§’ */
            position: relative; /* ç›¸å°å®šä½ï¼Œç”¨æ–¼éŠæˆ²çµæŸç•«é¢çš„çµ•å°å®šä½ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
        }
        /* æ–¹å¡Š(tile)çš„é€šç”¨æ¨£å¼ */
        .tile {
            width: 100px; /* å¯¬åº¦ */
            height: 100px; /* é«˜åº¦ */
            background-color: #cdc1b4; /* é è¨­èƒŒæ™¯é¡è‰² */
            display: flex; /* ä½¿ç”¨ Flexbox å±…ä¸­å…§å®¹ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            font-size: 36px; /* å­—é«”å¤§å° */
            font-weight: bold; /* å­—é«”ç²—ç´° */
            color: #776e65; /* å­—é«”é¡è‰² */
            border-radius: 5px; /* åœ“è§’ */
            transition: transform 0.2s, background-color 0.2s; /* éæ¸¡æ•ˆæœï¼Œç”¨æ–¼å‹•ç•« */
        }
        /* ä¸åŒæ•¸å€¼çš„æ–¹å¡ŠèƒŒæ™¯é¡è‰²å’Œå­—é«”é¡è‰² */
        .tile[data-value="2"] { background-color: #eee4da; }
        .tile[data-value="4"] { background-color: #ede0c8; }
        .tile[data-value="8"] { background-color: #f2b179; color: #f9f6f2; }
        .tile[data-value="16"] { background-color: #f59563; color: #f9f9f2; }
        .tile[data-value="32"] { background-color: #f67c5f; color: #f9f6f2; }
        .tile[data-value="64"] { background-color: #f65e3b; color: #f9f6f2; }
        .tile[data-value="128"] { background-color: #edcf72; color: #f9f6f2; }
        .tile[data-value="256"] { background-color: #edcc61; color: #f9f6f2; }
        .tile[data-value="512"] { background-color: #edc850; color: #f9f6f2; }
        .tile[data-value="1024"] { background-color: #edc53f; color: #f9f6f2; }
        .tile[data-value="2048"] { background-color: #edc22e; color: #f9f6f2; }
        /* åˆä½µå‹•ç•«æ•ˆæœ */
        .tile.merge {
            animation: merge 0.3s ease-in-out; /* æ‡‰ç”¨ merge å‹•ç•« */
        }
        /* merge å‹•ç•«é—œéµå½±æ ¼ */
        @keyframes merge {
            0% {
                transform: scale(1.2); /* åˆå§‹æ”¾å¤§ */
            }
            50% {
                transform: scale(1.3); /* ä¸­é–“æ›´å¤§ */
            }
            100% {
                transform: scale(1); /* æ¢å¾©åŸå§‹å¤§å° */
            }
        }
        /* éŠæˆ²çµæŸ/å‹åˆ©ç•«é¢æ¨£å¼ */
        #game-over {
            display: none; /* é è¨­éš±è— */
            position: absolute; /* çµ•å°å®šä½ */
            top: 50%; /* å‚ç›´å±…ä¸­ */
            left: 50%; /* æ°´å¹³å±…ä¸­ */
            transform: translate(-50%, -50%); /* ç²¾ç¢ºå±…ä¸­ */
            background-color: rgba(0, 0, 0, 0.7); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
            color: #fff; /* ç™½è‰²å­—é«” */
            padding: 20px; /* å…§é‚Šè· */
            border-radius: 10px; /* åœ“è§’ */
            text-align: center; /* æ–‡å­—å±…ä¸­ */
            z-index: 10; /* ç¢ºä¿åœ¨å…¶ä»–å…ƒç´ ä¹‹ä¸Š */
        }
        /* éŠæˆ²çµæŸ/å‹åˆ©ç•«é¢æŒ‰éˆ•æ¨£å¼ */
        #game-over button {
            margin-top: 10px; /* ä¸Šæ–¹é–“è· */
            padding: 10px 20px; /* å…§é‚Šè· */
            font-size: 18px; /* å­—é«”å¤§å° */
            border: none; /* ç„¡é‚Šæ¡† */
            background-color: #f67c5f; /* èƒŒæ™¯é¡è‰² */
            color: #fff; /* å­—é«”é¡è‰² */
            border-radius: 5px; /* åœ“è§’ */
            cursor: pointer; /* æ»‘é¼ æŒ‡é‡è®Šç‚ºæ‰‹å‹ */
        }
        /* å›åˆ°ä¸»é æŒ‰éˆ•æ¨£å¼ */
        #home-button {
            display: none; /* é è¨­éš±è— */
            margin-top: 20px; /* å¢åŠ ä¸Šæ–¹é–“è· */
            padding: 10px 20px; /* å…§é‚Šè· */
            font-size: 18px; /* å­—é«”å¤§å° */
            border: none; /* ç„¡é‚Šæ¡† */
            background-color: #8f7a66; /* èƒŒæ™¯é¡è‰² */
            color: #fff; /* å­—é«”é¡è‰² */
            border-radius: 5px; /* åœ“è§’ */
            cursor: pointer; /* æ»‘é¼ æŒ‡é‡è®Šç‚ºæ‰‹å‹ */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); /* é™°å½±æ•ˆæœ */
            transition: background-color 0.3s; /* éæ¸¡æ•ˆæœ */
        }
        #home-button:hover {
            background-color: #a08d7a; /* é¼ æ¨™æ‡¸åœæ™‚çš„èƒŒæ™¯é¡è‰² */
        }
        /* æ„è¦‹åé¥‹æŒ‰éˆ•æ¨£å¼ */
        #feedback {
            position: fixed; /* å›ºå®šå®šä½ */
            bottom: 20px; /* è·é›¢åº•éƒ¨ 20px */
            right: 20px; /* è·é›¢å³å´ 20px */
            background-color: #8f7a66; /* èƒŒæ™¯é¡è‰² */
            color: #fff; /* å­—é«”é¡è‰² */
            padding: 10px 15px; /* å…§é‚Šè· */
            border-radius: 8px; /* åœ“è§’ */
            font-weight: bold; /* å­—é«”ç²—ç´° */
            text-decoration: none; /* ç„¡ä¸‹åŠƒç·š */
            font-size: 16px; /* å­—é«”å¤§å° */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3); /* é™°å½±æ•ˆæœ */
            transition: background-color 0.3s; /* éæ¸¡æ•ˆæœ */
            z-index: 5; /* ç¢ºä¿åœ¨å…¶ä»–å…ƒç´ ä¹‹ä¸Šï¼Œä½†ä½æ–¼ game-over */
        }
        #feedback:hover {
            background-color: #a08d7a; /* é¼ æ¨™æ‡¸åœæ™‚çš„èƒŒæ™¯é¡è‰² */
        }
    </style>
</head>
<body>
    <div id="difficulty-selection">
        <p>é¸æ“‡é›£åº¦ï¼š</p>
        <button onclick="startTutorial()">æ•™å­¸æ¨¡å¼</button>
        <button onclick="setBoardSize(4)">4x4</button>
        <button onclick="setBoardSize(5)">5x5</button>
        <button onclick="setBoardSize(6)">6x6</button>
        <button onclick="setBoardSize(7)">7x7</button>
    </div>
    <div id="score-board" style="display: none;">Score: <span id="score">0</span></div>
    <div id="game-board" style="display: none;"></div>
    <div id="game-over" style="display: none;">
        <p>Game Over!</p>
        <button onclick="restartGame()">Restart</button>
    </div>
    <button id="home-button" onclick="goHome()">å›åˆ°ä¸»é </button>

    <script>
        /* å…¨åŸŸè®Šæ•¸ */
        let boardSize = 4; // éŠæˆ²æ¿çš„å°ºå¯¸ (ä¾‹å¦‚ 4x4, 5x5)
        let board = []; // éŠæˆ²æ¿çš„äºŒç¶­é™£åˆ—ï¼Œå„²å­˜æ–¹å¡Šæ•¸å€¼
        let score = 0; // ç•¶å‰åˆ†æ•¸
        let isTutorial = false; // æ˜¯å¦è™•æ–¼æ•™å­¸æ¨¡å¼
        let tutorialStep = 0; // æ•™å­¸æ¨¡å¼çš„æ­¥é©Ÿ

        // æ•™å­¸æ¨¡å¼çš„æ­¥é©Ÿå®šç¾©
        const tutorialSteps = [
            {
                message: 'æ­¡è¿ä¾†åˆ°2048æ•™å­¸ï¼é¦–å…ˆï¼Œè©¦è‘—å‘å·¦æ»‘ï¼Œè®“å…©å€‹ 2 åˆä½µæˆ 4ï¼',
                board: [
                    [2, 2, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                expectedMove: 'left' // æ­¤æ­¥é©Ÿé æœŸçš„ç§»å‹•æ–¹å‘
            },
            {
                message: 'å¤ªæ£’äº†ï¼ç¾åœ¨ï¼Œè«‹å‘ä¸Šæ»‘ï¼Œæº–å‚™è¿æ¥ä¸‹ä¸€å€‹åˆä½µï¼',
                board: [
                    [0, 0, 0, 0],
                    [4, 0, 0, 0],
                    [4, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                expectedMove: 'up' // æ­¤æ­¥é©Ÿé æœŸçš„ç§»å‹•æ–¹å‘
            },
            {
                message: 'å®Œç¾æ”¶å·¥ ğŸ‰ ä½ å·²ç¶“å­¸æœƒ2048æ€éº¼ç©äº†ï¼',
                board: [
                    [8, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0],
                ],
                expectedMove: null // æ²’æœ‰é æœŸå‹•ä½œï¼Œè¡¨ç¤ºæ•™å­¸æ¨¡å¼çµæŸ
            }
        ];

        /* å–å¾— DOM å…ƒç´  */
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const gameOverDisplay = document.getElementById('game-over');
        const difficultySelection = document.getElementById('difficulty-selection');
        const scoreBoard = document.getElementById('score-board');
        const homeButton = document.getElementById('home-button'); // å›åˆ°ä¸»é æŒ‰éˆ•

        /**
         * å•Ÿå‹•æ•™å­¸æ¨¡å¼ã€‚
         * è¨­ç½®æ•™å­¸æ¨¡å¼ç›¸é—œè®Šæ•¸ï¼Œéš±è—é›£åº¦é¸æ“‡ï¼Œé¡¯ç¤ºéŠæˆ²ä»‹é¢ï¼Œä¸¦åŠ è¼‰ç¬¬ä¸€æ­¥æ•™å­¸ã€‚
         */
        function startTutorial() {
            isTutorial = true;
            tutorialStep = 0;
            difficultySelection.style.display = 'none'; // éš±è—é›£åº¦é¸æ“‡
            scoreBoard.style.display = 'block'; // é¡¯ç¤ºåˆ†æ•¸æ¿
            gameBoard.style.display = 'grid'; // é¡¯ç¤ºéŠæˆ²æ¿
            gameBoard.style.gridTemplateColumns = `repeat(4, 100px)`; // æ•™å­¸æ¨¡å¼å›ºå®š 4x4 ç¶²æ ¼
            gameBoard.style.gridGap = '10px'; // ç¶²æ ¼é–“è·
            homeButton.style.display = 'block'; // é¡¯ç¤ºå›åˆ°ä¸»é æŒ‰éˆ•
            loadTutorialStep(); // åŠ è¼‰æ•™å­¸æ¨¡å¼çš„ç¬¬ä¸€æ­¥
        }

        /**
         * åŠ è¼‰æ•™å­¸æ¨¡å¼çš„æŒ‡å®šæ­¥é©Ÿã€‚
         * æ ¹æ“š tutorialStep è¼‰å…¥å°æ‡‰çš„éŠæˆ²æ¿ç‹€æ…‹å’Œè¨Šæ¯ã€‚
         */
        function loadTutorialStep() {
            const step = tutorialSteps[tutorialStep]; // å–å¾—ç•¶å‰æ•™å­¸æ­¥é©Ÿçš„è³‡æ–™
            boardSize = 4; // æ•™å­¸æ¨¡å¼é™å®š 4x4
            board = JSON.parse(JSON.stringify(step.board)); // æ·±æ‹·è²æ•™å­¸æ¿ç‹€æ…‹åˆ°ç•¶å‰éŠæˆ²æ¿
            score = 0; // åˆ†æ•¸æ­¸é›¶
            updateScore(0); // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
            gameBoard.innerHTML = ''; // æ¸…ç©ºéŠæˆ²æ¿ä¸Šçš„æ‰€æœ‰æ–¹å¡Š
            // æ ¹æ“š boardSize å‰µå»ºæ–°çš„æ–¹å¡Šå…ƒç´ ä¸¦æ·»åŠ åˆ°éŠæˆ²æ¿
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.dataset.row = row; // å„²å­˜è¡Œç´¢å¼•
                    tile.dataset.col = col; // å„²å­˜åˆ—ç´¢å¼•
                    gameBoard.appendChild(tile);
                }
            }
            updateBoard(); // æ›´æ–°éŠæˆ²æ¿çš„è¦–è¦ºç‹€æ…‹
            showMessage(step.message); // é¡¯ç¤ºç•¶å‰æ­¥é©Ÿçš„æç¤ºè¨Šæ¯
            // éš±è—é‡æ–°é–‹å§‹æŒ‰éˆ•ï¼Œç›´åˆ°æ•™å­¸çµæŸæˆ–éŠæˆ²çµæŸ
            gameOverDisplay.querySelector('button').style.display = 'none';
        }

        /**
         * é¡¯ç¤ºéŠæˆ²çµæŸæˆ–å‹åˆ©è¨Šæ¯ã€‚
         * @param {string} msg - è¦é¡¯ç¤ºçš„è¨Šæ¯ã€‚
         */
        function showMessage(msg) {
            gameOverDisplay.style.display = 'block'; // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            gameOverDisplay.querySelector('p').textContent = msg; // æ›´æ–°è¨Šæ¯æ–‡å­—
        }

        /**
         * è¨­ç½®éŠæˆ²æ¿å°ºå¯¸ä¸¦é–‹å§‹éŠæˆ²ã€‚
         * @param {number} size - éŠæˆ²æ¿çš„å°ºå¯¸ (ä¾‹å¦‚ 4, 5, 6, 7)ã€‚
         */
        function setBoardSize(size) {
            boardSize = size;
            isTutorial = false; // é€€å‡ºæ•™å­¸æ¨¡å¼
            difficultySelection.style.display = 'none'; // éš±è—é›£åº¦é¸æ“‡
            scoreBoard.style.display = 'block'; // é¡¯ç¤ºåˆ†æ•¸æ¿
            gameBoard.style.display = 'grid'; // é¡¯ç¤ºéŠæˆ²æ¿
            // æ ¹æ“šé¸å®šçš„å°ºå¯¸è¨­å®šç¶²æ ¼åˆ—æ•¸
            gameBoard.style.gridTemplateColumns = `repeat(${boardSize}, 100px)`;
            gameBoard.style.gridGap = '10px'; // ç¶²æ ¼é–“è·
            homeButton.style.display = 'block'; // é¡¯ç¤ºå›åˆ°ä¸»é æŒ‰éˆ•
            initGame(); // åˆå§‹åŒ–éŠæˆ²
        }

        /**
         * åˆå§‹åŒ–éŠæˆ²ã€‚
         * é‡ç½®åˆ†æ•¸ã€éŠæˆ²æ¿ï¼Œä¸¦ç”Ÿæˆå…©å€‹åˆå§‹æ–¹å¡Šã€‚
         */
        function initGame() {
            score = 0; // åˆ†æ•¸æ­¸é›¶
            updateScore(0); // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
            gameOverDisplay.style.display = 'none'; // éš±è—éŠæˆ²çµæŸç•«é¢
            // åˆå§‹åŒ–ä¸€å€‹å¡«å…… 0 çš„äºŒç¶­é™£åˆ—ä½œç‚ºéŠæˆ²æ¿
            board = Array.from({ length: boardSize }, () => Array(boardSize).fill(0));
            gameBoard.innerHTML = ''; // æ¸…ç©ºéŠæˆ²æ¿ä¸Šçš„æ‰€æœ‰æ–¹å¡Š
            // æ ¹æ“š boardSize å‰µå»ºæ–°çš„æ–¹å¡Šå…ƒç´ ä¸¦æ·»åŠ åˆ°éŠæˆ²æ¿
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.dataset.row = row;
                    tile.dataset.col = col;
                    gameBoard.appendChild(tile);
                }
            }
            addRandomTile(); // æ·»åŠ ç¬¬ä¸€å€‹éš¨æ©Ÿæ–¹å¡Š
            addRandomTile(); // æ·»åŠ ç¬¬äºŒå€‹éš¨æ©Ÿæ–¹å¡Š
            updateBoard(); // æ›´æ–°éŠæˆ²æ¿çš„è¦–è¦ºç‹€æ…‹
        }

        /**
         * åœ¨éš¨æ©Ÿçš„ç©ºä½æ·»åŠ ä¸€å€‹æ–°çš„æ–¹å¡Š (2 æˆ– 4)ã€‚
         */
        function addRandomTile() {
            const emptyTiles = []; // å„²å­˜æ‰€æœ‰ç©ºæ–¹å¡Šçš„ä½ç½®
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    if (board[row][col] === 0) {
                        emptyTiles.push({ row, col }); // å¦‚æœæ–¹å¡Šç‚º 0 (ç©º)ï¼Œå‰‡åŠ å…¥åˆ—è¡¨
                    }
                }
            }
            if (emptyTiles.length > 0) {
                // å¾ç©ºæ–¹å¡Šä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹ä½ç½®
                const { row, col } = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                // 90% æ©Ÿç‡ç”Ÿæˆ 2ï¼Œ10% æ©Ÿç‡ç”Ÿæˆ 4
                board[row][col] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        /**
         * æ›´æ–°éŠæˆ²æ¿çš„è¦–è¦ºç‹€æ…‹ (HTML)ã€‚
         * æ ¹æ“š board é™£åˆ—çš„æ•¸å€¼æ›´æ–°æ¯å€‹æ–¹å¡Šçš„å…§å®¹å’Œæ¨£å¼ã€‚
         */
        function updateBoard() {
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    // æ ¹æ“š data-row å’Œ data-col å±¬æ€§æ‰¾åˆ°å°æ‡‰çš„æ–¹å¡Šå…ƒç´ 
                    const tile = document.querySelector(`.tile[data-row='${row}'][data-col='${col}']`);
                    const value = board[row][col]; // å–å¾—æ–¹å¡Šæ•¸å€¼
                    tile.textContent = value === 0 ? '' : value; // å¦‚æœç‚º 0 å‰‡é¡¯ç¤ºç‚ºç©ºå­—ä¸²ï¼Œå¦å‰‡é¡¯ç¤ºæ•¸å€¼
                    tile.dataset.value = value; // è¨­ç½® data-value å±¬æ€§ï¼Œç”¨æ–¼ CSS æ¨£å¼
                    // ç§»é™¤ merge é¡åˆ¥ï¼Œç‚ºä¸‹ä¸€æ¬¡å¯èƒ½çš„å‹•ç•«åšæº–å‚™
                    if (tile.classList.contains('merge')) {
                        tile.classList.remove('merge');
                    }
                }
            }
        }

        /**
         * æ›´æ–°åˆ†æ•¸ã€‚
         * @param {number} points - è¦å¢åŠ çš„åˆ†æ•¸ã€‚
         */
        function updateScore(points) {
            score += points; // å¢åŠ åˆ†æ•¸
            scoreDisplay.textContent = score; // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
        }

        /**
         * å°‡ä¸€è¡Œ (æˆ–åˆ—) ä¸­çš„éé›¶æ•¸å­—æ»‘å‹•åˆ°ä¸€å´ï¼Œä¸¦ç”¨é›¶å¡«å……ç©ºä½ã€‚
         * @param {Array<number>} row - è¦è™•ç†çš„ä¸€è¡Œæˆ–ä¸€åˆ—æ•¸å­—ã€‚
         * @returns {Array<number>} - æ»‘å‹•å¾Œçš„æ•¸å­—é™£åˆ—ã€‚
         */
        function slide(row) {
            const filtered = row.filter(val => val); // éæ¿¾æ‰æ‰€æœ‰ 0
            const zeros = Array(row.length - filtered.length).fill(0); // æ ¹æ“šåŸå§‹é•·åº¦è¨ˆç®—éœ€è¦è£œå……çš„ 0 æ•¸é‡
            return [...filtered, ...zeros]; // å°‡éé›¶æ•¸å­—å’Œ 0 åˆä½µ
        }

        /**
         * åˆä½µä¸€è¡Œ (æˆ–åˆ—) ä¸­ç›¸é„°ä¸”ç›¸åŒæ•¸å€¼çš„æ–¹å¡Šã€‚
         * @param {Array<number>} row - è¦è™•ç†çš„ä¸€è¡Œæˆ–ä¸€åˆ—æ•¸å­—ã€‚
         * @returns {Array<number>} - åˆä½µå¾Œçš„æ•¸å­—é™£åˆ—ã€‚
         */
        function combine(row) {
            for (let i = 0; i < row.length - 1; i++) {
                if (row[i] !== 0 && row[i] === row[i + 1]) { // å¦‚æœç•¶å‰å’Œä¸‹ä¸€å€‹æ–¹å¡Šç›¸åŒä¸”ä¸ç‚º 0
                    row[i] *= 2; // ç•¶å‰æ–¹å¡Šæ•¸å€¼ç¿»å€
                    updateScore(row[i]); // æ›´æ–°åˆ†æ•¸
                    row[i + 1] = 0; // ä¸‹ä¸€å€‹æ–¹å¡Šæ­¸é›¶ (è¢«åˆä½µ)
                    // æ³¨æ„ï¼šåœ¨æ­¤è™•åŠ å…¥åˆä½µå‹•ç•« (éœ€è¦ç¢ºä¿ tile å…ƒç´ å­˜åœ¨ä¸”å‹•ç•«è¨­å®šæ­£ç¢º)
                    // ç›®å‰è¨»è§£æ‰ï¼Œå› ç‚ºç›´æ¥åœ¨é€™è£¡æ“ä½œ DOM å¯èƒ½æœƒå’Œ updateBoard å‡½å¼è¡çªï¼Œ
                    // æ›´ç©©å¥çš„åšæ³•æ˜¯åœ¨ move å‡½å¼ä¸­è¿½è¹¤è®Šå‹•ä¸¦çµ±ä¸€è™•ç†å‹•ç•«ã€‚
                    // ä¾‹å¦‚ï¼Œè¨˜éŒ„å“ªäº›æ–¹å¡Šç™¼ç”Ÿäº†åˆä½µï¼Œç„¶å¾Œåœ¨ updateBoard å¾Œæ‡‰ç”¨å‹•ç•«ã€‚
                }
            }
            return row; // è¿”å›è™•ç†å¾Œçš„è¡Œ
        }

        /**
         * è™•ç†éŠæˆ²æ¿çš„ç§»å‹•é‚è¼¯ã€‚
         * æ ¹æ“šæŒ‡å®šæ–¹å‘æ»‘å‹•å’Œåˆä½µæ–¹å¡Šï¼Œä¸¦åœ¨ç§»å‹•å¾Œæ·»åŠ æ–°æ–¹å¡Šï¼ˆéæ•™å­¸æ¨¡å¼ï¼‰ã€‚
         * @param {string} direction - ç§»å‹•æ–¹å‘ ('left', 'right', 'up', 'down')ã€‚
         */
        function move(direction) {
            // å¦‚æœæ˜¯æ•™å­¸æ¨¡å¼ï¼Œæª¢æŸ¥ç©å®¶çš„ç§»å‹•æ˜¯å¦ç¬¦åˆé æœŸ
            if (isTutorial) {
                const step = tutorialSteps[tutorialStep];
                if (step.expectedMove && direction !== step.expectedMove) { // å¦‚æœæœ‰é æœŸå‹•ä½œä¸”æ–¹å‘ä¸ç¬¦
                    alert('éŒ¯äº†å–”ï¼é€™æ­¥è¦å¾€ã€Œ' + step.expectedMove + 'ã€æ‰å°ï¼Œç…§æç¤ºåšå•¦ï¼');
                    return; // éŒ¯èª¤æ–¹å‘ï¼Œä¸åŸ·è¡Œå¾ŒçºŒç§»å‹•é‚è¼¯
                }
            }

            let moved = false; // æ¨™è¨˜æ˜¯å¦æœ‰æ–¹å¡Šå¯¦éš›ç§»å‹•æˆ–åˆä½µ
            // æ·±æ‹·è²ç§»å‹•å‰çš„æ¿é¢ç‹€æ…‹ï¼Œç”¨æ–¼åˆ¤æ–·æ˜¯å¦æœ‰å¯¦éš›ç§»å‹•
            const originalBoard = JSON.parse(JSON.stringify(board));

            // æ ¹æ“šç§»å‹•æ–¹å‘è™•ç†æ¯ä¸€è¡Œæˆ–æ¯ä¸€åˆ—
            for (let i = 0; i < boardSize; i++) {
                let line; // line å¯èƒ½æ˜¯ row (æ©«å‘ç§»å‹•) æˆ– column (ç¸±å‘ç§»å‹•)
                if (direction === 'left' || direction === 'right') {
                    line = [...board[i]]; // å–å¾—ç•¶å‰è¡Œ
                    if (direction === 'right') line.reverse(); // å‘å³ç§»å‹•å‰‡åè½‰è¡Œ

                    line = combine(slide(line)); // æ»‘å‹•ä¸¦åˆä½µ
                    if (direction === 'right') line.reverse(); // å‘å³ç§»å‹•å‰‡å†æ¬¡åè½‰æ¢å¾©é †åº
                    board[i] = line; // æ›´æ–°éŠæˆ²æ¿çš„è¡Œ
                } else { // 'up' or 'down' (è™•ç†åˆ—)
                    line = board.map(r => r[i]); // å–å¾—ç•¶å‰åˆ—
                    if (direction === 'down') line.reverse(); // å‘ä¸‹ç§»å‹•å‰‡åè½‰åˆ—

                    line = combine(slide(line)); // æ»‘å‹•ä¸¦åˆä½µ
                    if (direction === 'down') line.reverse(); // å‘ä¸‹ç§»å‹•å‰‡å†æ¬¡åè½‰æ¢å¾©é †åº
                    // å°‡è™•ç†å¾Œçš„åˆ—é‡æ–°è³¦å€¼å›éŠæˆ²æ¿
                    for (let j = 0; j < boardSize; j++) {
                        board[j][i] = line[j];
                    }
                }
            }

            // æª¢æŸ¥ç§»å‹•å‰å¾Œæ¿é¢æ˜¯å¦æœ‰ä»»ä½•è®ŠåŒ–ï¼Œåˆ¤æ–·æ˜¯å¦æœ‰å¯¦éš›ç§»å‹•
            for(let r = 0; r < boardSize; r++) {
                for(let c = 0; c < boardSize; c++) {
                    if (originalBoard[r][c] !== board[r][c]) {
                        moved = true; // æœ‰è®ŠåŒ–è¡¨ç¤ºæœ‰ç§»å‹•
                        break;
                    }
                }
                if (moved) break;
            }

            // å¦‚æœæœ‰æ–¹å¡Šç§»å‹•æˆ–åˆä½µ
            if (moved) {
                if (isTutorial) {
                    updateBoard(); // æ›´æ–° UI
                    tutorialStep++; // é€²å…¥æ•™å­¸æ¨¡å¼çš„ä¸‹ä¸€æ­¥
                    if (tutorialStep < tutorialSteps.length) {
                        // ç¨å¾®å»¶é²ï¼Œè®“ç©å®¶çœ‹åˆ°åˆä½µæ•ˆæœå¾Œå†åŠ è¼‰ä¸‹ä¸€æ­¥
                        setTimeout(loadTutorialStep, 500);
                    } else {
                        // æ•™å­¸çµæŸ
                        showMessage('å®Œç¾æ”¶å·¥ ğŸ‰ ä½ å·²ç¶“å­¸æœƒ2048æ€éº¼ç©äº†ï¼');
                        // é¡¯ç¤ºé‡æ–°é–‹å§‹æŒ‰éˆ•ï¼Œä¸¦ç¢ºä¿å…¶ç¶å®š restartGame
                        gameOverDisplay.querySelector('button').style.display = 'inline-block';
                        gameOverDisplay.querySelector('button').onclick = restartGame;
                        isTutorial = false; // é€€å‡ºæ•™å­¸æ¨¡å¼
                    }
                } else {
                    // ä¸€èˆ¬éŠæˆ²æ¨¡å¼
                    addRandomTile(); // æ·»åŠ ä¸€å€‹æ–°çš„éš¨æ©Ÿæ–¹å¡Š
                    updateBoard(); // æ›´æ–° UI
                    if (checkWin()) { // æª¢æŸ¥æ˜¯å¦é”åˆ° 2048 å‹åˆ©
                        showMessage('ä½ è´äº†å•¦ï¼ğŸ‰ğŸ‰');
                        gameOverDisplay.querySelector('button').style.display = 'inline-block';
                        gameOverDisplay.querySelector('button').onclick = restartGame;
                    } else if (isGameOver()) { // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
                        gameOverDisplay.style.display = 'block';
                        gameOverDisplay.querySelector('button').style.display = 'inline-block';
                        gameOverDisplay.querySelector('button').onclick = restartGame;
                    }
                }
            }
        }

        /**
         * æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ (æ²’æœ‰å¯ç§»å‹•çš„æ–¹å¡Šæˆ–å¯åˆä½µçš„æ–¹å¡Š)ã€‚
         * @returns {boolean} - å¦‚æœéŠæˆ²çµæŸè¿”å› trueï¼Œå¦å‰‡è¿”å› falseã€‚
         */
        function isGameOver() {
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    if (board[row][col] === 0) return false; // é‚„æœ‰ç©ºä½ï¼ŒæœªçµæŸ
                    // æª¢æŸ¥æ°´å¹³æ–¹å‘æ˜¯å¦æœ‰å¯åˆä½µçš„æ–¹å¡Š
                    if (col < boardSize - 1 && board[row][col] === board[row][col + 1]) return false;
                    // æª¢æŸ¥å‚ç›´æ–¹å‘æ˜¯å¦æœ‰å¯åˆä½µçš„æ–¹å¡Š
                    if (row < boardSize - 1 && board[row][col] === board[row + 1][col]) return false;
                }
            }
            return true; // æ²’æœ‰ç©ºä½ä¸”æ²’æœ‰å¯åˆä½µçš„æ–¹å¡Šï¼ŒéŠæˆ²çµæŸ
        }

        /**
         * é‡æ–°é–‹å§‹éŠæˆ²ã€‚
         */
        function restartGame() {
            initGame(); // é‡æ–°åˆå§‹åŒ–éŠæˆ²
            gameOverDisplay.querySelector('button').onclick = restartGame; // ç¢ºä¿æŒ‰éˆ•é‡æ–°ç¶å®š
        }

        /**
         * å›åˆ°ä¸»é é¢ (é›£åº¦é¸æ“‡ç•«é¢)ã€‚
         */
        function goHome() {
            isTutorial = false; // ç¢ºä¿é€€å‡ºæ•™å­¸æ¨¡å¼
            gameOverDisplay.style.display = 'none'; // éš±è—éŠæˆ²çµæŸ/å‹åˆ©è¨Šæ¯
            scoreBoard.style.display = 'none'; // éš±è—åˆ†æ•¸æ¿
            gameBoard.style.display = 'none'; // éš±è—éŠæˆ²æ¿
            homeButton.style.display = 'none'; // éš±è—å›åˆ°ä¸»é æŒ‰éˆ•
            difficultySelection.style.display = 'flex'; // é¡¯ç¤ºé›£åº¦é¸æ“‡
        }

        /* äº‹ä»¶ç›£è½å™¨ */

        // éµç›¤æ§åˆ¶ (ç®­é ­éµ)
        document.addEventListener('keydown', e => {
            // æª¢æŸ¥æ˜¯å¦ç‚ºæ–¹å‘éµ
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.key)) {
                e.preventDefault(); // é˜²æ­¢é é¢æ»¾å‹• (ç•¶ä½¿ç”¨æ–¹å‘éµæ™‚)
                switch (e.key) {
                    case 'ArrowLeft':
                        move('left');
                        break;
                    case 'ArrowRight':
                        move('right');
                        break;
                    case 'ArrowUp':
                        move('up');
                        break;
                    case 'ArrowDown':
                        move('down');
                        break;
                }
            }
        });

        // æ‰‹æ©Ÿè§¸æ§æ»‘å‹•æ§åˆ¶
        let touchStartX = 0;
        let touchStartY = 0;

        // è§¸æ‘¸é–‹å§‹äº‹ä»¶
        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX; // è¨˜éŒ„è§¸æ‘¸é–‹å§‹çš„ X åº§æ¨™
            touchStartY = e.touches[0].clientY; // è¨˜éŒ„è§¸æ‘¸é–‹å§‹çš„ Y åº§æ¨™
        }, { passive: false }); // ä½¿ç”¨ passive: false å…è¨±åœ¨äº‹ä»¶è™•ç†å™¨ä¸­èª¿ç”¨ preventDefault

        // è§¸æ‘¸çµæŸäº‹ä»¶ (åˆ¤æ–·æ»‘å‹•æ–¹å‘)
        document.addEventListener('touchend', function(e) {
            const dx = e.changedTouches[0].clientX - touchStartX; // è¨ˆç®— X æ–¹å‘çš„ç§»å‹•è·é›¢
            const dy = e.changedTouches[0].clientY - touchStartY; // è¨ˆç®— Y æ–¹å‘çš„ç§»å‹•è·é›¢

            const minSwipeDistance = 30; // å®šç¾©æœ€å°æ»‘å‹•è·é›¢ï¼Œé¿å…èª¤è§¸
            // åˆ¤æ–·æ˜¯æ°´å¹³æ»‘å‹•é‚„æ˜¯å‚ç›´æ»‘å‹•ï¼Œä¸¦åŸ·è¡Œå°æ‡‰çš„ç§»å‹•
            if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > minSwipeDistance) {
                if (dx > 0) move('right'); // å‘å³æ»‘å‹•
                else move('left'); // å‘å·¦æ»‘å‹•
            } else if (Math.abs(dy) > minSwipeDistance) {
                if (dy > 0) move('down'); // å‘ä¸‹æ»‘å‹•
                else move('up'); // å‘ä¸Šæ»‘å‹•
            }
            e.preventDefault(); // é˜²æ­¢é»æ“Šè§¸ç™¼å…¶ä»–è¡Œç‚º (ä¾‹å¦‚æ‰‹æ©Ÿç€è¦½å™¨çš„é è¨­æ»¾å‹•)
        }, { passive: false });

        /**
         * æª¢æŸ¥éŠæˆ²æ˜¯å¦å‹åˆ© (é”åˆ° 2048 æ–¹å¡Š)ã€‚
         * @returns {boolean} - å¦‚æœå‹åˆ©è¿”å› trueï¼Œå¦å‰‡è¿”å› falseã€‚
         */
        function checkWin() {
            for (let row = 0; row < boardSize; row++) {
                for (let col = 0; col < boardSize; col++) {
                    if (board[row][col] === 2048) {
                        return true; // æ‰¾åˆ° 2048 æ–¹å¡Šï¼Œå‹åˆ©
                    }
                }
            }
            return false; // æœªæ‰¾åˆ° 2048 æ–¹å¡Š
        }
    </script>
    <a id="feedback" href="https://mail.google.com/mail/?view=cm&fs=1&to=hsc0529.myself.tw@gmail.com" target="_blank">æ„è¦‹åé¥‹</a>

</body>
</html>